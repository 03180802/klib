# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
- master

parameters:
  image: ['ubuntu-16.04','macos-10.14','vs2017-win2016']
  python.version: ['3.6','3.7', '3.8']

jobs:
  - ${{ each platform in parameters.platform }}:
    - ${{ each test in parameters.test }}:
      - ${{ each testlevel2 in parameters.testlevel2 }}:
        - job: 
          displayName: ${{ platform }}_${{ test }}
          steps:
          - task: Powershell@2
            displayName: '${{ platform }}-${{ test }}'
            inputs:
              targettype: inline
              script: echo '${{ platform }}-${{ test }}'


steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'

- script: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt
  displayName: 'Install dependencies'

- script: |
    pip install pytest pytest-azurepipelines
    pytest
  displayName: 'pytest'
